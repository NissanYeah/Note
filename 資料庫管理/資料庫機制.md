# 資料庫架構

- DBMS：操作資料儲存的系統，比如說MySQL是DBMS，他可以去操作底層硬體的資料儲存方式，也可以連接到遠端的機器去操作資料儲存。

![RelationShip](./圖片/clientType.png)

- Fat Client：主要由Client負責運送，但會導致Client的工作量很重
    - Server：儲存資料
    - Client：去Server用SQL拿資料＋運算＋畫面呈現
> 每個Client都要裝DBMS（像是MySQL）去操作資料庫
> 缺點：
- Thin Client：主要由Server負責儲存資料＋資料存取＋運算
    - Server：儲存資料＋資料存取＋運算
    - Client：畫面呈現
> 像是ATM就屬於Thin Client架構，介面只有很簡單的功能，完全讓遠端伺服器操控。
> 缺點是Serve可能loading太重。
- Distributed：平均分配運算
    - Server：儲存資料＋資料存取＋部分資料運算
    - Client：畫面呈現＋部分資料運算

- One tier

- Two-Tier Database Server
    - Client：讀取資料庫並且進行資料運算
    - Database server:儲存資料
- Three-Tier Architectures:
    - Client：呈現畫面
    - Application server：處理商業邏輯
    - Database server:儲存資料


## ODBC（Open Database Connectivity）

提供API，讓一般的應用程式可以用自己的程式語言去存取資料庫的內容。

- ODBC：提供API，讓一般的應用程式可以用自己的程式語言去存取資料庫的內容
- JDBC：
- ADO.NET：

# 資料庫機制

## ACID

MySQL資料具有ACID的性質
- A（Atomic）：transaction（交易）不能被分開，全有全無
- C（Consistent）：只要資料庫確認儲存，就會真的確認
- I（Isolated）：兩筆transaction（交易）不會互相影響
- D（Durable）：一但資料改變就是永久的


```sql
BEGIN transaction
    .
    . #中間若發生錯誤就會自動rollback
    .
END transaction
COMMIT 
```

## Concurrency Control 共同控制

資料庫自己有分散式系統的演算法，可以控制共同存取，保持資料可以維持一致。

John從A帳號1000中，提款200，剩下800。同時Nissen也從A帳號提款300，剩下700，結果資料庫就把剩餘700的資訊寫入資料庫，但John的更改沒有更新，因此這就是`lost update`。

### 1. Serializability（循序排隊）

大家排隊使用資料庫，但頻繁的資料庫的資料更新是60-100/s（掏寶可能到1000／s)，因此這種方式會造成塞車。
### 2. Locking Machanisms（鎖定機制）

如果有人在使用Ａ資料，這個時候Ａ就會放Lock，其他人就只能讀，不能寫，直到該筆資料被unlock。（例如：Excel上面一個欄位如果有人在改，其他人就不能改。）
    - Locking level：鎖定層級影響越大，操作性就愈低。例如鎖住Table，那其他人就不能用。因此所愈小可操作性愈高，例如鎖住record。
    - Type Of locks：
        - Shared lock（Read lock）：可以同時讀，但是只能有一個人寫
        - Exclusive lock：不可以同時讀，也只能有一個人寫
### Dead lock 死鎖

John放Read lock表示我要讀，Neo也放Read lock表示我要讀。之後John要改用Write lock但是發現Neo有Read lock就不能放。然後Neo也發現John有Read lock也不能放Write lock。因此導致「大家彼此等待對方」，產生所謂的Dead lock。

- 預防機制（Two-phase locking protocol）
  - Growing phase 逐漸增加鎖定
  - Shrinkin phase 逐步釋放鎖定
- 解鎖（unlock）：機器隨機讓一個人交易失敗，然後讓對方可以重新執行。

### 3.Rollback（重回機制）

一但遇到和別人用一樣的資料，就回到上一步重新過來。
這種機制相信資料衝突的機率不多，因此可以一直重新來過。
但是對於容易碰撞的機制下，就是和使用Rollback（重回機制）

比如說，雙11產品庫存100。一個人要結帳時，這時候庫存要算100?還是99?，

# Data Security 資料安全


## 常見的意外

- Human error人為錯誤：像是有人不小心Drop table
- Hardware failure硬體錯誤：像是主機板燒掉
- Software failure軟體錯誤：很少有問題，通常是當初設計有問題。

> 人跟硬體是最有可能出錯的部分

## 網路防禦

Farawall  -> IDS(intrusion Detection System)

## Client-Server Application Security

靜態網頁：
- 用HTTPS
動態網頁：
 - 使用者憑證
 - 連線安全
 - 傳輸加密
 - 人數及連線限制
 - 移除不用的程式（避免有木馬程式）

## Data Privacy

好的網站最好可以符合P3P原則（Platform for Privacy Protection）

- 誰收集資料
- 收集用途
- 誰可以使用
- 使用者可控制
- 爭議如何處理
- 如何保存資料

# 資料倉儲（Data Warehousing）

它是一種特別應用的資料庫

- subject-Oriented（圍繞特定主題）：有特定的主題，例如顧客、病人、學生、產品。
- Intergrated（整合）：要將不同來源的資料進行整合。EX：把同屬於顧客的資料整合在一起。
- Time-Variant（時間相關）：會把歷史資料留下來。EX:把之前的合約資料、購物資料都留下來。
- Non-updatable（不可更新）：唯獨，週期性更新。EX：之前的合約資料不可以再更改。